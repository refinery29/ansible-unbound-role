server:
{% for zone in unbound_local_zones %}
  local-zone: "{{ zone.name }}" {{ zone.type | default("redirect") }}
{% endfor %}

{% for resource in unbound_local_data %}
{% set quote = "'" if resource.type == 'TXT' else '"' %}
  local-data: {{ quote }}{{ resource | dns_resource_record }}{{ quote }}
{% if resource.ptr | default(False) %}
  local-data-ptr: "{{ resource.value | default(resource.address) }} {{ resource.name }}"
{% endif %}
{% endfor %}

{% for host in unbound_A_record_inventory_hosts %}
{% set hostname = hostvars[host]['ansible_hostname'] + '.' + unbound_domain %}
{% set ip_address = hostvars[host]['ansible_all_ipv4_addresses'] | ipaddr('private') | first %}
  local-data: "{{ hostname }} 60 IN A {{ ip_address }}"
  local-data-ptr: "{{ ip_address}} {{ hostname }}"
{% endfor %}

{% for service in unbound_A_record_services %}
{% set hostname = 'service-' +  service.name + '.' + unbound_domain %}
{% set ip_address = hostvars[groups[service.group][0]]['ansible_all_ipv4_addresses'] | ipaddr('private') | first %}
  local-data: "{{ hostname }} 60 IN A {{ ip_address }}"
  local-data-ptr: "{{ ip_address}} {{ hostname }}"
{% endfor %}
